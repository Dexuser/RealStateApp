@using RealStateApp.Core.Domain.Common
@model RealStateApp.Core.Application.ViewModels.Offer.OfferListViewModel

@{
    ViewData["Title"] = "Ofertas del Cliente";
}

<div class="container py-4">

    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="fw-bold">Ofertas Realizadas por el Cliente</h2>
    </div>

    <!-- Si no hay ofertas -->
    @if (!Model.Offers.Any())
    {
        <div class="alert alert-info">
            Este cliente no ha realizado ofertas para esta propiedad.
        </div>
    }
    else
    {
        <div class="table-responsive">
            <table class="table table-bordered align-middle">
                <thead class="table-light">
                    <tr>
                        <th>Fecha</th>
                        <th>Monto</th>
                        <th>Estado</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody>
                @foreach (var offer in Model.Offers)
                {
                    <tr>
                        <td>@offer.CreatedAt.ToString("dd/MM/yyyy hh:mm tt")</td>
                        <td><strong>$@offer.Amount</strong></td>
                        <td>
                            @switch (offer.Status)
                            {
                                case OfferStatus.Pending:
                                    <span class="badge bg-warning text-dark">Pendiente</span>;
                                    break;
                                case OfferStatus.Accepted:
                                    <span class="badge bg-success">Aceptada</span>;
                                    break;
                                case OfferStatus.Rejected:
                                    <span class="badge bg-danger">Rechazada</span>;
                                    break;
                            }
                        </td>
                        <td>
                            @if (offer.Status == OfferStatus.Pending)
                            {
                                <div class="d-flex gap-2">

                                    <!-- Botón Aceptar -->
                                    <form asp-controller="Offer"
                                          asp-action="Decide"
                                          method="post"
                                          class="m-0 p-0">
                                        <input type="hidden" name="offerId" value="@offer.Id" />
                                        <input type="hidden" name="accepted" value="true" />
                                        <button type="submit" class="btn btn-success btn-sm">
                                            <i class="bi bi-check-circle"></i> Aceptar
                                        </button>
                                    </form>

                                    <!-- Botón Rechazar -->
                                    <form asp-controller="Offer"
                                          asp-action="Decide"
                                          method="post"
                                          class="m-0 p-0">
                                        <input type="hidden" name="offerId" value="@offer.Id" />
                                        <input type="hidden" name="accepted" value="false" />
                                        <button type="submit" class="btn btn-danger btn-sm">
                                            <i class="bi bi-x-circle"></i> Rechazar
                                        </button>
                                    </form>

                                </div>
                            }
                            else
                            {
                                <span class="text-muted">—</span>
                            }
                        </td>

                    </tr>
                }
                </tbody>
            </table>
        </div>
    }

</div>
